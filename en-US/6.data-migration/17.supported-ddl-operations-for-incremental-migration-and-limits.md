# Supported DDL operations in incremental migration and limits

This topic describes the supported DDL operations in different types of incremental migration projects and their limits.

## Supported DDL operations in incremental migration from a MySQL database to a MySQL tenant of OceanBase Database and limits

### Overview

* Supported DDL operations

  * `CREATE TABLE`

  * `ALTER TABLE`

  * `TRUNCATE TABLE`

  * `RENAME TABLE`

  * `DROP TABLE`

  * `CREATE INDEX`

  * `DROP INDEX`

* Unsupported DDL operations

  * CREATE/DROP/ALTER DATABASE

  * CREATE/DROP/ALTER FUNCTION

  * CREATE/DROP/ALTER PROCEDURE

  * CREATE/DROP/ALTER EVENT

  * CREATE/DROP/ALTER VIEW

  * CREATE/DROP/ALTER ROLE

  * CREATE/DROP/ALTER TRIGGER

  * CREATE/DROP/ALTER USER

  * CREATE/DROP/ALTER SERVER

  * CREATE/DROP/ALTER TABLESPACE

### `CREATE TABLE`

* When you use the CREATE TABLE statement to create a table, you can specify the `IF NOT EXISTS` keyword and the `LIKE` option. Example:

   ```sql
   CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name
   { LIKE old_tbl_name | (LIKE old_tbl_name) }
   ```

* You cannot use this statement to create a temporary table. The `TEMPORARY` keyword will be ignored.

   > **Note**
   >
   > You can create temporary tables in MySQL tenants of OceanBase Database V3.2.3.

* You cannot use the `CREATE TABLE AS SELECT` statement to create a table based on the output of a SELECT statement. This is because an empty string will be output in this scenario.

Syntax:

```sql
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name
    (create_definition,...)   
    [table_options]
    [partition_options]
```

| Category | Description |
|-------------------|--------------------------------------------------------------|
| create_definition | `create_definition` allows you to create columns, indexes, or constraints. For more information, see Create columns and Create indexes or constraints following this table.  |
| table_options | <ul><li>You can use this clause to specify COMMENT at the table level. <li> You can use this clause to specify `CHARACTER SET`. <li>Other table options cannot be parsed and will be ignored. </ul> |
| partition_options | <ul><li>You can use this clause to specify LIST, RANGE, HASH, and KEY partitions to be created.<br>For a LIST partition, you can specify a function partitioning key or column partitioning key.<br>For a RANGE partition, you can specify a function partitioning key or column partitioning key.<br>For a HASH partition, you can specify a function partitioning key or column partitioning key, and define LINEAR HASH.<br>For a KEY partition, you can specify a column partitioning key and define LINEAR KEY.   <li> You can use this clause to specify HASH and KEY subpartitions to be created.    <li> You can specify PARTITIONS number and SUBPARTITIONS number.      </ul> |

> **Notice**
>
> MySQL tenants of OceanBase Database support only certain character sets.
>
> Do not use unsupported character sets, such as Latin-1. If you forcibly specify an unsupported character set for a MySQL tenant of OceanBase Database, this character set will not be converted during DDL synchronization to the destination database and an error will be returned.

`create_definition` allows you to create columns, indexes, or constraints.

* Create columns

  When you create columns, you can:

  * Specify the NULL or NOT NULL attribute.

  * Specify the DEFAULT attribute, which can be a constant or a function.

  * Specify the VISIBLE or INVISIBLE attribute.

  * Specify AUTO_INCREMENT.

  * Specify COMMENT.

  * Specify COLLATE.

  * Specify the VIRTUAL | STORED attribute.

  * Specify the UNIQUE KEY, PRIMARY KEY, or KEY attribute. For more information, see Create indexes or constraints following this section.

  * Specify CHECK constraints (supported only in MySQL tenants of OceanBase Database V3.2.3). For more information, see Create indexes or constraints following this section.

  * Specify foreign keys. For more information, see Create indexes or constraints following this section.

  * The following table lists the supported data types.

    <table>
        <tr>
            <td colspan="2"><b>Classification</b></td>
            <td><b>MySQL database</b></td>
            <td><b>MySQL tenant of OceanBase Database</b></td>
        </tr>
        <tr>
            <td rowspan="12">Data types</td>
            <td rowspan="6">Integer data types</td>
            <td>INT</td>
            <td>INT</td>
        </tr>
        <tr>
            <td>TINYINT</td>
            <td>TINYINT</td>
        </tr>
        <tr>
            <td>SMALLINT</td>
            <td>SMALLINT</td>
        </tr>
        <tr>
            <td>MEDIUMINT</td>
            <td>MEDIUMINT</td>
        </tr>
        <tr>
            <td>BIGINT</td>
            <td>BIGINT</td>
        </tr>
        <tr>
            <td>BOOL/BOOLEAN</td>
            <td>BOOLEAN</td>
        </tr>
        <tr>
            <td rowspan="2">Fixed-point data types</td>
            <td>DECIMAL</td>
            <td>DECIMAL</td>
        </tr>
        <tr>
            <td>NUMERIC</td>
            <td>NUMERIC</td>
        </tr>
        <tr>
            <td rowspan="3">Floating-point data types</td>
            <td>REAL</td>
            <td>FLOAT</td>
        </tr>
        <tr>
            <td>DOUBLE</td>
            <td>DOUBLE</td>
        </tr>
        <tr>
            <td>FLOAT</td>
            <td>FLOAT</td>
        </tr>
        <tr>
            <td>BIT data type</td>
            <td>BIT</td>
            <td>BIT</td>
        </tr>
        <tr>
            <td rowspan="6" colspan="2">Character data types</td>
            <td>CHAR</td>
            <td>CHAR</td>
        </tr>
        <tr>
            <td>NCHAR</td>
            <td>CHAR</td>
        </tr>
        <tr>
            <td>VARCHAR</td>
            <td>VARCHAR</td>
        </tr>
        <tr>
            <td>BINARY</td>
            <td>BINARY</td>
        </tr>
        <tr>
            <td>VARBINARY</td>
            <td>VARBINARY</td>
        </tr>
        <tr>
            <td>LONG VARBINARY</td>
            <td>BLOB</td>
        </tr>
        <tr>
            <td rowspan="5" colspan="2">Date and time data types</td>
            <td>YEAR</td>
            <td>YEAR</td>
        </tr>
        <tr>
            <td>DATE</td>
            <td>DATE</td>
        </tr>
        <tr>
            <td>TIME</td>
            <td>TIME</td>
        </tr>
        <tr>
            <td>TIMESTAMP</td>
            <td>TIMESTAMP</td>
        </tr>
        <tr>
            <td>DATETIME</td>
            <td>DATETIME</td>
        </tr>
        <tr>
            <td rowspan="8" colspan="2">BLOB and TEXT data types</td>
            <td>TINYBLOB</td>
            <td>TINYBLOB</td>
        </tr>
        <tr>
            <td>MEDIUMBLOB</td>
            <td>MEDIUMBLOB</td>
        </tr>
        <tr>
            <td>BLOB</td>
            <td>BLOB</td>
        </tr>
        <tr>
            <td>LONGBLOB</td>
            <td>LONGBLOB</td>
        </tr>
        <tr>
            <td>TINYTEXT</td>
            <td>TINYTEXT</td>
        </tr>
        <tr>
            <td>MEDIUMTEXT</td>
            <td>MEDIUMTEXT</td>
        </tr>
        <tr>
            <td>TEXT</td>
            <td>TEXT</td>
        </tr>
        <tr>
            <td>LONGTEXT</td>
            <td>LONGTEXT</td>
        </tr>
        <tr>
            <td rowspan="2" colspan="2">Enumeration and set data types</td>
            <td>ENUM</td>
            <td>ENUM</td>
        </tr>
        <tr>
            <td>SET</td>
            <td>SET</td>
        </tr>
        <tr>
            <td colspan="2">JSON data type</td>
            <td>JSON</td>
            <td>TEXT (for MySQL tenants of OceanBase Database of a version earlier than V3.2.3) or JSON (for MySQL tenants of OceanBase Database V3.2.3 and later) </td>
        </tr>
    </table>

    SERIAL and GEOMETRY data types cannot be converted, such as GEOMETRY, GEOMETRYCOLLECTION, POINT, MULTIPOINT, LINESTRING, MULTILINESTRING, POLYGON, and MULTIPOLYGON.

    > Notice:
    >
    > If an unsupported data type is used, empty DDL statements will be output.

  The following attributes will not be parsed or converted but only ignored when they are specified in incremental DDL statements:

  * COLUMN_FORMAT

  * ENGINE_ATTRIBUTE

  * SECONDARY_ENGINE_ATTRIBUTE

  * STORAGE

    Due to the limits of MySQL tenants of OceanBase Database, an error may be returned when the converted incremental DDL statements are synchronized to a MySQL tenant of OceanBase Database in the following scenarios:

  * The MySQL tenant of OceanBase Database does not support specifying certain functions or expressions in the DEFAULT attribute.

  * The MySQL tenant of OceanBase Database does not support specifying certain functions or expressions in generated columns.

  * The MySQL tenant of OceanBase Database does not support specifying the UNIQUE KEY, PRIMARY KEY, or KEY attribute for certain field types.

  * The MySQL tenant of OceanBase Database does not support certain collations.

* Create indexes or constraints

  When you create indexes or constraints, you can:

  * Create primary keys.

  * Create unique keys.

  * Create indexes or keys.

  * Create foreign keys on fields, functions, or expressions.

    Specify the ON [DELETE, UPDATE] | RESTRICT | CASCADE | NO ACTION | SET | DEFAULT attribute.

  * Create full-text indexes.

  * Create CHECK constraints in MySQL tenants of OceanBase Database V3.2.3 and later.

  * Create prefix indexes.

  * Specify the ASC or DESC attribute.

    When you create indexes or constraints, you cannot:

  * Create primary keys, unique keys, indexes, keys, or full-text indexes on functions. You can create indexes only on fields.

    > **Notice**
    >
    > If incremental DDL statements contain the following unsupported definitions, the whole table creation statement will fail and an empty string will be output.

    Primary key, unique key, index, key, or full-text index definitions that contain functions or expressions. Examples:

    ```sql
      CREATE TABLE functional_index_t1 (col1 INT, PRIMARY KEY (col1, (ABS(col1))));
      CREATE TABLE functional_index_t1(x VARCHAR(30), INDEX idx ((CAST(x->>'$.name' AS CHAR(30)))));
      ```

  * Create spatial indexes.

  * Specify the ON [DELETE | UPDATE] SET NULL option for foreign keys.

    The following attributes will not be parsed or converted but only ignored when they are specified in incremental DDL statements:

  * USING BTREE or USING HASH

  * KEY_BLOCK_SIZE, index_type, WITH PARSER, COMMENT, VISIBLE | INVISIBLE, ENGINE_ATTRIBUTE, or SECONDARY_ENGINE_ATTRIBUTE in index_option

  * [NOT] ENFORCED for CHECK constraints

  * MATCH FULL | MATCH PARTIAL | MATCH SIMPLE option for foreign keys

    Due to the limits of MySQL tenants of OceanBase Database, an error may be returned when the converted incremental DDL statements are synchronized to a MySQL tenant of OceanBase Database in the following scenarios:

  * The MySQL tenant of OceanBase Database does not support creating primary keys, unique keys, indexes, keys, full-text indexes, or foreign keys on specific types of fields.

  * The MySQL tenant of OceanBase Database does not support specifying certain functions or expressions in CHECK constraints.

  * The MySQL tenant of OceanBase Database does not support specifying certain functions or expressions in FOREIGN KEY constraints.

  * The MySQL tenant of OceanBase Database does not support certain collations.

* Create partitions

  When you create partitions, you can:

  * Create RANGE, LIST, HASH, or KEY partitions.

  * Create HASH or KEY subpartitions.

  * For RANGE, LIST, and HASH partitions, you can specify a function partitioning key (an expression or a function) or column partitioning key (a field). For KEY partitions, you can specify only a column partitioning key.

  * Specify PARTITIONS number and SUBPARTITIONS number.

    You cannot create LINEAR HASH or LINEAR KEY partitions.

    > Notice
    >
    > If the DDL statement for creating a partition contains unsupported definitions, the output partition definition is empty, but the schemas are retained (with the partition definition discarded).

  The following attributes will not be parsed or converted but only ignored when they are specified in incremental DDL statements:

  * ENGINE

  * COMMENT

  * DATA DIRECTORY

  * INDEX DIRECTORY

  * MAX_ROWS

  * MIN_ROWS

  * TABLESPACE

  * ALGORITHM (for KEY partitions)

    `PARTITION BY KEY ALGORITHM={1 | 2} (column_list) -> PARTITION BY KEY  (column_list)`

  Due to the limits of MySQL tenants of OceanBase Database, an error may be returned when the converted incremental DDL statements are synchronized to a MySQL tenant of OceanBase Database in the following scenarios:

  * The MySQL tenant of OceanBase Database does not support using fields of certain types as the partitioning key.

  * The MySQL tenant of OceanBase Database does not support using certain functions or expressions as the partitioning key.

### `ALTER TABLE`

When you modify a table, you can operate its columns, constraints, indexes, and partitions, as well as modify its attributes.

* Operate columns

  When you operate columns, you can add, drop, and modify columns. To be specific, you can:

  * Use ADD COLUMN to add one or more columns, with the FIRST | AFTER keyword being specified.

  * Use `ALTER COLUMN SET DEFAULT` to modify the default value of a column.

  * Use `ALTER COLUMN DROP DEFAULT` to drop the default value of a column.

  * Use `CHANGE COLUMN` or `MODIFY COLUMN` to change or modify a column.

  * Use `DROP COLUMN` to drop a column.

  If incremental DDL statements contain the following unsupported definitions, the whole table creation statement will fail and an empty string will be output.

  * `ALTER COLUMN SET VISIBLE | INVISIBLE`

  * `ORDER BY col_name`

  * `RENAME COLUMN`

    ```sql
    ALTER TABLE t RENAME COLUMN d TO g;
    ```

  If incremental DDL statements contain the `MODIFY COLUMN` or `CHANGE COLUMN` clause, the FIRST | AFTER keyword will be ignored.

  Due to the limits of MySQL tenants of OceanBase Database, an error may be returned when the converted incremental DDL statements are synchronized to a MySQL tenant of OceanBase Database in the following scenarios:

  * Using the `MODIFY COLUMN` or `CHANGE COLUMN` clause to modify the field type may fail. This is because certain field types are not supported in MySQL tenants of OceanBase Database.

  * Using the `MODIFY COLUMN` or `CHANGE COLUMN` statement to modify the field length may fail.

  * Using the `ALTER COLUMN SET DEFAULT` statement to set a default value may fail. This is because certain functions or expressions are not supported in MySQL tenants of OceanBase Database.

  * You cannot drop columns that are used as primary keys, unique keys, or normal indexes, or columns with FOREIGN KEY constraints.

* Operate constraints and indexes

  When you operate constraints or indexes, you can add and drop constraints or indexes. To be specific, you can:

  * Use ADD INDEX | KEY to create a normal index.

  * Use DROP INDEX to drop an index.

  * Use ADD FULLTEXT INDEX | KEY to create a full-text index.

  * Use ADD UNIQUE INDEX | KEY to create a unique index.

  * Use ADD FOREIGN KEY to create a foreign key.

    When you operate constraints or indexes, you cannot:

    > Notice
    >
    > If incremental DDL statements contain the following unsupported definitions, the whole table creation statement will fail and an empty string will be output.

  * Create unique keys, indexes, keys, and full-text indexes on functions. You can create indexes only on fields.

  * Use `ADD SPATIAL INDEX`.

  * Use `ADD PRIMARY KEY`.

  * Use `DROP PRIMARY KEY`.

  * Use `ALTER TABLE DISABLE | ENABLE KEYS`.

  * Specify the `ON [DELETE | UPDATE] SET NULL` attribute for foreign keys.

  * In MySQL tenants of OceanBase Database of a version earlier than V3.2.3, you cannot:

    * Use `ADD CHECK`.

    * Use `DROP CHECK`.

    * Use `ALTER CHECK [NOT] ENFORCED`.

    * Use `ALTER INDEX VISIBLE | INVISIBLE`.

    * Use `RENAME INDEX | KEY`.

      ```sql
      alter table t rename key k to kk;
      ALTER TABLE T RENAME INDEX b TO w;
      ```

  * Use `ALTER TABLE DISABLE | ENABLE KEYS`.

  * Specify the `ON [DELETE | UPDATE] SET NULL` attribute for foreign keys.

    The following attributes will not be parsed or converted but only ignored when they are specified in incremental DDL statements:

  * `USING BTREE` or `USING HASH`

  * `KEY_BLOCK_SIZE`, `index_type`, `WITH PARSER`, `COMMENT`, `VISIBLE | INVISIBLE`, `ENGINE_ATTRIBUTE`, or `SECONDARY_ENGINE_ATTRIBUTE` in `index_option`

  * `[NOT] ENFORCED` for CHECK constraints

  * `MATCH FULL | MATCH PARTIAL | MATCH SIMPLE` for foreign keys`

    Due to the limits of MySQL tenants of OceanBase Database, an error may be returned when the converted incremental DDL statements are synchronized to a MySQL tenant of OceanBase Database in the following scenarios:

  * The MySQL tenant of OceanBase Database does not support creating primary keys, unique keys, indexes, keys, full-text indexes, or foreign keys on specific types of fields.

  * The MySQL tenant of OceanBase Database does not support specifying certain functions or expressions in CHECK constraints.

  * The MySQL tenant of OceanBase Database does not support specifying certain functions or expressions in FOREIGN KEY constraints.

* Operate partitions

  When you operate partitions, you can:

  * Use `ADD PARTITION` to add a RANGE partition.

  * Use `ADD PARTITION` to add a LIST partition.

  * Use `DROP PARTITION` to drop a partition.

    When you operate partitions, you cannot:

    > Notice
    >
    > If incremental DDL statements contain the following unsupported definitions, the whole table creation statement will fail and an empty string will be output.

  * Use `ADD PARTITION` to add a HASH partition.

  * Use `TRUNCATE PARTITION`.

  * Use `DISCARD PARTITION`.

  * Use `IMPORT PARTITION`.

  * Use `COALESCE PARTITION`.

  * Use `REORGANIZE PARTITION`.

  * Use `EXCHANGE PARTITION`.

  * Use `ANALYZE PARTITION`.

  * Use `CHECK PARTITION`.

  * Use `OPTIMIZE PARTITION`.

  * Use `REBUILD PARTITION`.

  * Use `REPAIR PARTITION`.

  * Use `REMOVE PARTITIONING`.

* Modify table attributes

  When you modify table attributes, you can:

  * Rename tables.

    ```sql
    alter table tablename rename to new_tablename
    ```

  * Modify table comments.
  
    ```sql
    ALTER TABLE t comment = 'table comment'
    ```

   When you modify table attributes, you cannot:

  * Modify the ALGORITHM attribute.

    ```sql
    ALTER TABLE t ALGORITHM = COPY
    ```

  * Convert to a specified character set.

      ```sql
      ALTER TABLE t CONVERT TO CHARACTER SET utf16;
      ```

  * Modify the character set or collation.

    ```sql
    ALTER TABLE T DEFAULT CHARACTER SET utf8
    ```

  * Specify the DISCARD | IMPORT TABLESPACE attribute.

  * Use ALTER TABLE FORCE.

  * Modify the LOCK attribute: LOCK = DEFAULT | NONE | SHARED | EXCLUSIVE

  * Use ALTER TABLE WITHOUT | WITH VALIDATION.

  * Modify attributes except COMMENT in table_option.

### `TRUNCATE TABLE`

```sql
  TRUNCATE [TABLE] tbl_name
```

### `RENAME TABLE`

When you migrate data from a MySQL database to a MySQL tenant of OceanBase Database, you can execute the `RENAME TABLE` statement to rename one or more tables.

### `DROP TABLE`

When you migrate data from a MySQL database to a MySQL tenant of OceanBase Database, you can execute the `DROP TABLE` statement to drop one or more tables.

The following attributes will not be parsed or converted but only ignored when they are specified in incremental DDL statements:

* TEMPORARY in MySQL tenants of OceanBase Database of a version earlier than V3.2.3

* IF EXISTS

* RESTRICT | CASCADE

### `CREATE INDEX`

When you create indexes, you can:

* Create normal indexes.

* Create unique indexes.

* Create prefix indexes.

   ```sql
   create index i on t(c1(2))
   ```

* Specify only COMMENT in `index_option`.

When you create indexes, you cannot:

> Notice
>
> If incremental DDL statements contain the following unsupported definitions, the whole table creation statement will fail and an empty string will be output.

* Create spatial indexes.

* Create function indexes.

The following attributes will not be parsed or converted but only ignored when they are specified in incremental DDL statements:

* ASC | DESC

* `KEY_BLOCK_SIZE`

* `WITH PARSER`

* `VISIBLE | INVISIBLE`

* `ENGINE_ATTRIBUTE`

* `SECONDARY_ENGINE_ATTRIBUTE`

* `ALGORITHM = DEFAULT | INPLACE | COPY`

* `LOCK = DEFAULT | NONE | SHARED | EXCLUSIVE`

Due to the limits of MySQL tenants of OceanBase Database, you cannot create indexes on specific types of fields. Otherwise, an error may be returned when the converted incremental DDL statements are synchronized to a MySQL tenant of OceanBase Database.

### `DROP INDEX`

When you migrate data from a MySQL database to a MySQL tenant of OceanBase Database, you can drop indexes.

The following attributes will not be parsed or converted but only ignored when they are specified in incremental DDL statements:

* ALGORITHM = DEFAULT | INPLACE | COPY

* LOCK = DEFAULT | NONE | SHARED | EXCLUSIVE

### Limits of DDL operations in incremental migration

* If a table to be synchronized involves DDL operations that are not supported, the migration project may fail and unrecoverable data exceptions may be caused.

* Frequent DDL operations on a table are not supported. After the store finishes a DDL operation, which can be determined based on the timestamp, it proceeds to the next DDL operation. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

* Make sure that no DDL operations are performed before you create a store and when a store is being started. If log pulling is involved, make sure that no DDL operations are performed during the period from the start time when logs are pulled to the current time. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

* The table names before and after the `RENAME TABLE` statement must be both included or both not included in the list of tables to be synchronized.

* If you enable DDL operations in incremental migration, the `DROP INDEX` statement is executed on all indexes, which may cause index loss in the destination database.

* In a DDL operation for incremental migration, if the primary key of a table is data of the FLOAT or DOUBLE type, data inconsistency may occur.

* If you use gh-ost to synchronize DDL operations in incremental migration from a MySQL database to a MySQL tenant of OceanBase Database:

  * When you select the **Specify Objects** mode, do not select the table named `*_ghc`.

  * When you select the **Match Rules** mode, set **Object Exclusion Rules** to `{database_name}.*_ghc`.

## Supported DDL operations in incremental migration from a MySQL tenant of OceanBase Database to a MySQL database and limits

OMS supports MySQL 5.5, 5.6, 5.7, and 8.0.

* Supported DDL operations in incremental migration

  * `CREATE TABLE`

    > **Note**
    >
    > `CREATE TABLE AS SELECT` is not supported.

  * `DROP TABLE`

  * `TRUNCATE TABLE`

  * `ALTER TABLE CHANGE COLUMN`

    > **Notice**
    >
    > You can only extend the column length. You cannot modify the column type.

  * `ALTER TABLE ADD COLUMN`

  * `ALTER TABLE ALTER COLUMN SET DEFAULT` and `ALTER TABLE ALTER COLUMN DROP DEFAULT`

  * `ALTER TABLE DROP COLUMN`

  * `CREATE INDEX` and `ALTER TABLE ADD INDEX`

  * `DROP INDEX` and `ALTER TABLE DROP INDEX`

* Limits of DDL operations in incremental migration

  * If a table to be synchronized involves DDL operations that are not supported, the migration link may be interrupted and unrecoverable data exceptions may be caused.

  * Frequent DDL operations on a table are not supported. After the store finishes a DDL operation, which can be determined based on the timestamp, it proceeds to the next DDL operation. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * Make sure that no DDL operations are performed before you create a store and when a store is being started. If log pulling is involved, make sure that no DDL operations are performed during the period from the start time when logs are pulled to the current time. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * The table names before and after the `RENAME TABLE` statement must be both included or both not included in the list of tables to be synchronized.

  * If you enable DDL operations in incremental migration, the `DROP INDEX` statement is executed on all indexes, which may cause index loss in the destination database.

## Supported DDL operations in incremental migration from an Oracle database to an Oracle tenant of OceanBase Database

* Supported DDL operations in incremental migration

  * `CREATE TABLE`

    You can create partitioned tables but cannot use `CREATE TABLE AS SELECT` to create tables.

  * `DROP TABLE`

  * `TRUNCATE TABLE`

  * `ADD PARTITION`

    You can add partitions and subpartitions by using RANGE or LIST partitioning. HASH partitioning is not supported.

  * `DROP PARTITION`

    You can drop one or more partitions and subpartitions.

  * `TRUNCATE PARTITION`

    You can truncate one or more partitions and subpartitions.

  * `RENAME TABLE` and `ALTER TABLE RENAME`

  * `ALTER TABLE ADD COLUMN`

  * `ALTER TABLE MODIFY COLUMN`

    > **Notice**
    >
    > You can only extend the column length. You cannot modify the column type.

  * `ALTER TABLE DROP COLUMN`

  * `CREATE INDEX`

  * `DROP INDEX`

  * Adding comments to tables or columns

* Limits of DDL operations in incremental migration

  * If a table to be synchronized involves DDL operations that are not supported, the migration link may be interrupted and unrecoverable data exceptions may be caused.

  * Frequent DDL operations on a table are not supported. After the store finishes a DDL operation, which can be determined based on the timestamp, it proceeds to the next DDL operation. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * Make sure that no DDL operations are performed before you create a store and when a store is being started. If log pulling is involved, make sure that no DDL operations are performed during the period from the start time when logs are pulled to the current time. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * The table names before and after the `RENAME TABLE` statement must be both included or both not included in the list of tables to be synchronized.

  * If you delete an unnamed primary key, the corresponding constraint whose name starts with `SYS_C` in the Oracle database is deleted. If you perform inter-database data migration or synchronization, for example, from an Oracle database to an OceanBase database, the primary keys in the OceanBase database cannot be deleted because they are different from those in the Oracle database.

  * A table creation DDL operation that involves the `CASE WHEN INDEX` clause cannot be synchronized.

  * If you enable DDL operations in incremental migration, the `DROP INDEX` statement is executed on all indexes, which may cause index loss in the destination database.

## Supported DDL operations in incremental migration from an Oracle tenant of OceanBase Database to an Oracle database

* Supported DDL operations in incremental migration

  * `CREATE TABLE`

    You can create partitioned tables but cannot use `CREATE TABLE AS SELECT` to create tables.

  * `DROP TABLE`

  * `TRUNCATE TABLE`

  * `ADD PARTITION`

      You can add partitions and subpartitions by using RANGE or LIST partitioning. HASH partitioning is not supported.

  * `DROP PARTITION`

      You can drop one or more partitions and subpartitions.

  * `TRUNCATE PARTITION`

      You can truncate one or more partitions and subpartitions.

  * `RENAME TABLE` and `ALTER TABLE RENAME`

  * `ALTER TABLE ADD COLUMN`

  * `ALTER TABLE MODIFY COLUMN`

      > **Notice**
      >
      > You can only extend the column length. You cannot modify the column type.

  * `CREATE INDEX`

  * `DROP INDEX`

  * Adding or dropping comments on tables or columns

* Limits of DDL operations in incremental migration

  * Only the DDL operations that are listed in the preceding section are supported. If the table to be synchronized involves other types of DDL operations, the migration may fail and cause unrecoverable data exceptions.

  * Frequent DDL operations on a table are not supported. After the store finishes a DDL operation, which can be determined based on the timestamp, it proceeds to the next DDL operation. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * Make sure that no DDL operations are performed before you create a store and when a store is being started. If log pulling is involved, make sure that no DDL operations are performed during the period from the start time when logs are pulled to the current time. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * The table names before and after the `RENAME TABLE` statement must be both included or both not included in the list of tables to be synchronized.

  * If you delete an unnamed primary key, the corresponding constraint whose name starts with `SYS_C` in the Oracle database is deleted. If you perform inter-database data migration or synchronization, for example, from an Oracle database to an OceanBase database, the primary keys in the OceanBase database cannot be deleted because they are different from those in the Oracle database.

  * When you migrate data from an Oracle tenant of OceanBase Database to an Oracle database, you cannot perform a DDL operation that changes a table with a primary key to a table without a primary key.

    * If a table in the Oracle tenant of OceanBase Database has a `primary key`, all DDL operations are supported.

    * If a table in the Oracle tenant of OceanBase Database has only a `not-null unique key`, a DDL operation that removes the `not-null unique key` is not supported.

  * A table creation DDL operation that involves the `CASE WHEN INDEX` clause cannot be synchronized.

  * If you enable DDL operations in incremental migration, the `DROP INDEX` command is executed on all indexes, which may cause index loss in the destination database.

## Dynamic DDL operations during data migration between an Oracle tenant of OceanBase Database and a DB2 LUW database

* Supported DDL operations

  * `CREATE TABLE`

  * `ALTER TABLE`

  * `DROP TABLE`

  * `TRUNCATE TABLE`

  * `RENAME TABLE`

  * `CREATE INDEX`

  * `DROP INDEX`

  * Adding or dropping comments on tables or columns

    The following DDL operations are supported when you migrate incremental data from DB2 LUW 10.1 to an Oracle tenant of OceanBase Database V2.2.76 or later:

  * `CREATE TABLE`

  * `DROP TABLE`

  * `TRUNCATE TABLE`

  * `RENAME TABLE`

  * `ADD COLUMN`

  * `MODIFY COLUMN`

* Limits

  * CREATE TABLE

    | Category | Description |
    |---------------|--------------------------------------------------------------------------------------------------------|
    | Syntax restriction | <ul><li> The CREATE LIKE syntax is not supported.    <li> A syntax that contains column type aliases (non-native data types) is not supported.    <li>A syntax that contains the SELECT clause or subqueries is not supported.    <li>An error may be returned if the generated column contains incompatible functions or complex expressions.    <li> A syntax that contains the XML data type is not supported.    </ul> |
    | Column attribute processing | <ul><li>Supported column attributes are the column name, column type, null or not null, and default value.    <li>DDL statements do not support attributes of generated columns and do not process the definitions of generated columns.    <li> Default values with functions should be used with caution. If a function used cannot be executed, the table creation will fail.     </ul> |
    | Index processing | <ul><li>We recommend that you explicitly define indexes, including primary keys, unique keys, and CHECK constraints. CHECK constraints are not preferred. Anonymous indexes automatically generate names, which may cause name conflicts.   <li> Functions should be used with caution. If a function used cannot be executed, the table creation will fail.   <li>Foreign keys are not recommended. OMS does not support synchronization of tables with foreign keys. Foreign keys will be discarded during DDL conversion.  |
    | Partition | <ul><li> OMS supports synchronization of time-based range partitions but directly translates expressions for non-time-based range partitions. We recommend that you do not use functions in partitions. Functions may cause incompatibility of syntax and further cause failure of the migration project.    <li> The range of a partition cannot start or end with a representation related to `MINVALUE` or `MAXVALUE`.   <li> Partitions of the DB2 LUW database must contain `ending` with the `exclusive` attribute. Otherwise, an error is returned.   <li> The DB2 LUW database does not support the `every` syntax extension for partitions to prevent calculation errors.    <li> In the DB2 LUW database, a partition column is added to the primary key of a table. If the primary key and partitioning key have no intersection, the primary key is changed to a unique index to adapt to the partition rules and constraints of OceanBase Database.   <li> In the DB2 LUW database, the `CREATE/ALTER TABLE ADD PARTITION` statement must carry partition names. Anonymous partitions are not supported.  </ul> |

  * ALTER TABLE

    * The `ALTER TABLE ADD PRIMARY` statement in a DB2 LUW database is converted to the `ADD UNIQUE` statement in an Oracle tenant of OceanBase Database. OceanBase Database does not support adding a primary key after a table is created. Therefore, you must explicitly specify the primary key when you create a table.

    * When you execute the `ALTER TABLE` statement to modify data of the LOB type, you must specify the data length. However, you cannot reduce the length of the LOB-type data by executing the `ALTER TABLE` statement.

    * The `UNIQUE INDEX` attribute cannot be null in a DB2 LUW database. Therefore, the column that is specified as the unique key requires a NOT NULL constraint. In other words, when you execute the `ALTER TABLE ADD UNIQUE` statement, you must specify the NOT NULL constraint for the related column.

  * CREATE INDEX

      You cannot specify the Local attribute in the statement to create a regular table in OceanBase Database.

  * Parse DDL statements

      When you parse DDL statements, you can refer to the official DB2 database documentation to ensure the maximum compatibility. Note the following limits when you parse the source DDL statements in a DB2 LUW database:

    * The DB2 LUW database checks the schema to refresh the cached, parsed source DDL statements. We recommend that you only parse one type of DDL statements at a time and proceed after you confirm the results.

    * Avoid frequent `CREATE` and `DROP` operations on partitioned tables. We recommend that you execute the `CREATE PARTITION TABLE` statement, confirm that the table is synchronized, and then execute the `DROP PARTITION TABLE` statement.

    * The DB2 LUW database can only parse an object whose name consists of letters, underscores (_), and digits, begins with a letter or underscore, and does not contain a DB2 LUW keyword.

    * If you enable DDL operations in incremental migration, the `DROP INDEX` command is executed on all indexes, which may cause index loss in the destination database.

## Supported DDL operations in incremental migration from a DB2 LUW database to a MySQL tenant of OceanBase Database and limits

| DDL operation | Supported | Unsupported |
|--------------------------------|-------------------------------------|------------------------------------------------|
| `CREATE TABLE` | <ul><li> Specify the NULL or NOT NULL attribute for columns.   <li> Specify the default value for a column.   <li> Create tables with the primary keys or unique keys.   <li> Create partitioned tables. Only RANGE-partitioned tables are supported.   <li>Generate columns.     </ul> | <ul><li> Add foreign keys.   <li> Add table-level or column-level CHECK constraints.   <li> Set hidden columns.   <li> Limits on partitions:<ul><li> A partition cannot be a right-closed interval. If a partition is a right-closed interval without using EXCLUSIVE to exclude the right boundary value, data conversion is not supported. In this case, the table schema is retained, but the partition information is lost.    <li>The every() method is not supported. If you use the every() method, the table schema is retained, but the partition information is lost.    <li>MySQL tenants of OceanBase Database do not support using columns of the DATETIME or TIMESTAMP type as the partitioning key.         </ul></ul> |
| `ALTER TABLE` | <ul><li> Columns <ul><li> Add multiple columns.   <li> Drop one or more columns.   <li>Change the column type.   <li> Modify the column length.<br>**Notice**<br>Make sure that the length after modification is greater than that before modification.    <li> Modify or delete the default value of a column.<br> **Notice**<br>The column value cannot be null.    <li> Specify the NULL or NOT NULL attribute for columns.   <li> Specify the default value for a column. </ul>    <li> Partitions<br>Add partitions on the condition that each expression contains EXCLUSIVE.   <li> Constraints<br>You can specify UNIQUE constraints.</ul> | <ul><li> Columns <ul><li> Modify or delete the NOT NULL attribute.   <li> Specify a column as the primary key.   <li> Specify `CHECK` constraints.   <li> Add or drop foreign keys.   <li> Rename columns.``</ul>  <li> Partitions <ul><li> Add partitions if any expression does not contain EXCLUSIVE.   <li> Detach partitions.``   <li> Attach partitions.``  </ul>   <li> Constraints <ul><li> Add or drop the primary key.   <li> Add or drop the CHECK constraint.   <li> Drop the unique key.    </ul></ul> |
| `DROP TABLE` | ``Drop a table. | None |
| `TRUNCATE TABLE` | ``Truncate a table. | None |
| `RENAME TABLE` | ``Rename a table. | None |
| `CREATE INDEX` | <ul><li> Create a normal index or a unique index.   <li> Create a partitioned index. </ul> | <ul><li> Sort data in descending order. This operation is not supported because the DESC keyword is lost.   <li> Use clustered indexes. This operation is not supported because the cluster information is lost.   <li> Use reverse indexes. This operation is not supported because the reverse key is lost.   <li> Merge or split indexed pages. </ul> |
| `DROP INDEX` | None | ``Drop an index. |
| `RENAME INDEX` | None | ``Rename an index. |
| `ADD COMMENT`/`DROP COMMENT` | Add and drop table-level comments. | Add or drop column-level comments. |

## Supported DDL operations in incremental migration from a MySQL tenant of OceanBase Database to a DB2 LUW database and limits

### Supported DDL operations

* `CREATE TABLE`

* `ALTER TABLE`

* `DROP TABLE`

* `TRUNCATE TABLE`

* `RENAME TABLE`

* `CREATE INDEX`

* `DROP INDEX`

* Adding or dropping comments on tables or columns

### Limits

* CREATE TABLE

   | Category | Description |
   |---------------|-------------------------------------------------------------------------------------------------------|
   | Syntax restriction | <ul><li> The CREATE LIKE syntax is not supported.    <li> A syntax that contains column type aliases (non-native data types) is not supported.    <li> A syntax that contains the SELECT clause or subqueries is not supported.   <li> An error may be returned if the generated column contains incompatible functions or complex expressions.    <li>A syntax that contains the XML data type is not supported.   </ul> |
   | Column attribute processing | <ul><li> Supported column attributes are the column name, column type, null or not null, and default value.    <li> DDL statements do not support attributes of generated columns and do not process the definitions of generated columns.    <li> Default values with functions should be used with caution. If a function used cannot be executed, the table creation will fail. </ul> |
   | Index processing | <ul><li> We recommend that you explicitly define indexes, including primary keys, unique keys, and CHECK constraints. CHECK constraints are not preferred. Anonymous indexes automatically generate names, which may cause name conflicts.   <li> Functions should be used with caution. If a function used cannot be executed, the table creation will fail.    <li> Foreign keys are not recommended. OMS does not support synchronization of tables with foreign keys. Foreign keys will be discarded during DDL conversion.  </ul> |
   | Partition | <ul><li> OMS supports synchronization of time-based range partitions but directly translates expressions for non-time-based range partitions. We recommend that you do not use functions in partitions. Functions may cause incompatibility of syntax and further cause failure of the migration project.    <li> The range of a partition cannot start or end with a representation related to `MINVALUE` or `MAXVALUE`.    <li> Partitions of the DB2 LUW database must contain `ending` with the `exclusive` attribute. Otherwise, an error is returned.    <li> The DB2 LUW database does not support the `every` syntax extension for partitions to prevent calculation errors.    <li> In the DB2 LUW database, a partition column is added to the primary key of a table. If the primary key and partitioning key have no intersection, the primary key is changed to a unique index to adapt to the partition rules and constraints of OceanBase Database.    <li> In the DB2 LUW database, the `CREATE/ALTER TABLE ADD PARTITION` statement must carry partition names. Anonymous partitions are not supported.  </ul> |

* ALTER TABLE

  * The `ALTER TABLE ADD PRIMARY` statement in a DB2 LUW database is converted to the `ADD UNIQUE` statement in an Oracle tenant of OceanBase Database. OceanBase Database does not support adding a primary key after a table is created. Therefore, you must explicitly specify the primary key when you create a table.

  * When you execute the `ALTER TABLE` statement to modify data of the LOB type, you must specify the data length. However, you cannot reduce the length of the LOB-type data by executing the `ALTER TABLE` statement.

  * The `UNIQUE INDEX` attribute cannot be null in a DB2 LUW database. Therefore, the column that is specified as the unique key requires a NOT NULL constraint. In other words, when you execute the `ALTER TABLE ADD UNIQUE` statement, you must specify the NOT NULL constraint for the related column.

* CREATE INDEX

   You cannot specify the Local attribute in the statement to create a regular table in OceanBase Database.

* Parse DDL statements

   When you parse DDL statements, you can refer to the official DB2 database documentation to ensure the maximum compatibility. Note the following limits when you parse the source DDL statements in a DB2 LUW database:

  * The DB2 LUW database checks the schema to refresh the cached, parsed source DDL statements. We recommend that you only parse one type of DDL statements at a time and proceed after you confirm the results.

  * Avoid frequent `CREATE` and `DROP` operations on partitioned tables. We recommend that you execute the `CREATE PARTITION TABLE` statement, confirm that the table is synchronized, and then execute the `DROP PARTITION TABLE` statement.

  * The DB2 LUW database can only parse an object whose name consists of letters, underscores (_), and digits, begins with a letter or underscore, and does not contain a DB2 LUW keyword.

  * If you do not select **DDL Synchronization** for your project, ensure that the source database involves no modifications and that the incremental DML data has been synchronized to the destination before DDL modifications. Then, perform related DDL operations in the source and destination databases respectively.

  * If you enable DDL operations in incremental migration, the `DROP INDEX` command is executed on all indexes, which may cause index loss in the destination database.

## Supported DDL operations in incremental migration between MySQL tenants of OceanBase Database

You can use DDL operations to migrate incremental data between MySQL tenants of OceanBase Database.

> **Notice**
>
> If you have created an `index` in the source tenant, it also exists in the destination tenant. OMS automatically ignores the `index` without interrupting the migration process.

* Supported DDL operations in incremental migration

  * `ALTER TABLE ADD COLUMN`

  * `ALTER TABLE MODIFY COLUMN`

      > **Notice**
      >
      > You can only extend the column length. You cannot modify the column type.

  * `ALTER TABLE ALTER COLUMN SET DEFAULT` and `ALTER TABLE ALTER COLUMN DROP DEFAULT`

  * `ALTER TABLE DROP COLUMN`

  * `CREATE TABLE`

  * `DROP TABLE`

  * `TRUNCATE TABLE`

  * `CREATE INDEX` and `ALTER TABLE ADD INDEX`

  * `DROP INDEX` and `ALTER TABLE DROP INDEX`

  * `RENAME TABLE` and `ALTER TABLE RENAME`

* Limits of DDL operations in incremental migration

  * If a table to be synchronized involves DDL operations that are not supported, the migration link may be interrupted and unrecoverable data exceptions may be caused.

  * Frequent DDL operations on a table are not supported. After the store finishes a DDL operation, which can be determined based on the timestamp, it proceeds to the next DDL operation. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * Make sure that no DDL operations are performed before you create a store and when a store is being started. If log pulling is involved, make sure that no DDL operations are performed during the period from the start time when logs are pulled to the current time. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * The table names before and after the `RENAME TABLE` statement must be both included or both not included in the list of tables to be synchronized.

  * If you enable DDL operations in incremental migration, the `DROP INDEX` command is executed on all indexes, which may cause index loss in the destination database.

## Supported DDL operations in incremental migration between Oracle tenants of OceanBase Database

* Supported DDL operations in incremental migration

  * `CREATE TABLE`

      You can create partitioned tables but cannot use `CREATE TABLE AS SELECT` to create tables. Partitions and subpartitions are supported. You can create partitions and subpartitions by using HASH, RANGE, or LIST partitioning.

  * `DROP TABLE`

  * `TRUNCATE TABLE`

  * `RENAME TABLE` and `ALTER TABLE RENAME`

  * `ALTER TABLE ADD COLUMN`

  * `ALTER TABLE MODIFY COLUMN`

      > **Notice**
      >
      > You can only extend the column length. You cannot modify the column type.

  * `CREATE INDEX`

  * `DROP INDEX`

  * Adding or dropping comments on tables or columns

* Limits of DDL operations in incremental migration

  * If a table to be synchronized involves DDL operations that are not supported, the migration link may be interrupted and unrecoverable data exceptions may be caused.

  * Frequent DDL operations on a table are not supported. After the store finishes a DDL operation, which can be determined based on the timestamp, it proceeds to the next DDL operation. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * Make sure that no DDL operations are performed before you create a store and when a store is being started. If log pulling is involved, make sure that no DDL operations are performed during the period from the start time when logs are pulled to the current time. Otherwise, the store may exit unexpectedly or cause unrecoverable data exceptions.

  * The table names before and after the `RENAME TABLE` statement must be both included or both not included in the list of tables to be synchronized.

  * A table creation DDL operation that involves the `case when index` statement cannot be synchronized.

  * If you enable DDL operations in incremental migration, the `DROP INDEX` command is executed on all indexes, which may cause index loss in the destination database.

## FAQ

Q: What can I do if a data migration project fails because I have performed an unsupported DDL operation in the source database?

A: Configure the DDL operation in SkipDDL and restart the data migration project. Procedure:

1. Go to the details page of the target project.

   1. Log on to the OMS console.

   2. In the left-side navigation pane, click `Data Migration`.

   3. In the **Migration Projects** list, click the name of the target project to go to its details page.

2. Click **View Component Monitoring** in the upper-right corner.

3. On the **View Component Monitoring** page, click **...** for the JDBCWriter component and choose **View Logs** from the short-cut menu.

4. Find the error DDL statement in the `error.log` file.

5. In the `ddl_msg.log` file, copy the content in `receive ddl:`.

6. Update component parameters.

   1. Return to the **View Component Monitoring** page and click **Update** for the JDBCWriter component.

   2. On the **Update Configurations** page, move the pointer over the `JDBCWriter.coordinatorFile.skipDdl` parameter. Click the Edit icon, change the value to the copied content, and click the Confirm icon. Multiple DDL statements must be separated with ampersands (&). You can also change the delimiter.

   3. Move the pointer over the `extraConfig` parameter. Click the Add icon, add the `JDBCWriter.coordinatorFile.skipDDLSeparator = "$"` parameter, and click the Confirm icon. The default value of the new parameter is \&.

   4. Click **Update**.

7. Return to the details page of the data migration project, and click **Restore** in the upper-right corner to run the project again.
