# Schema migration mechanisms

OceanBase Migration Service (OMS) Community Edition will provide a schema migration mechanism based on the actual situation of the data migration project.

## Background

When you advance to the forward switchover step in a data migration project, OMS Community Edition will add a hidden column to tables in the destination database and create a unique index based on the hidden column. The corresponding hidden column and index will be automatically deleted in the forward switchover step.

If you do not advance to the forward switchover step in a data migration project, you must manually drop the hidden columns and unique indexes based on the type of the data migration project as guided by this topic.

## Prerequisites

* "{partition_col_0}" or `{partition_col_0}` indicates a table partitioning key column. Multiple such fields may exist. Separate multiple fields with commas (,), Example: `"{partition_col_0}", "{partition_col_1}","{partition_col_2}"` or \`{partition_col_0}\`,\`{partition_col_1}\`,\`{partition_col_2}\`.

* {schema}, {table}, {partition_col_0}, and {partition_col_1} are respectively placeholders for the database name, table name, and partitioning key column names.

## Procedure

When you migrate data between MySQL tenants of OceanBase Database, OMS Community Edition will add columns and create unique indexes for tables without unique keys.

> **Notice**
>
> In active-active disaster recovery scenarios, you can migrate only tables with unique keys.

You can execute the following statement to check whether a table has a unique key. You must replace {schema} and {table} in the statement with the actual database name and table name. If no result is returned, the table has no unique key.

```sql
SELECT 1 FROM information_schema.statistics WHERE TABLE_SCHEMA = {schema} AND TABLE_NAME = {table} GROUP BY TABLE_SCHEMA, TABLE_NAME, INDEX_NAME HAVING count(1) = count(IF(upper(nullable) != 'YES' and NON_UNIQUE = 0, 1, NULL));
```

* Add columns.

   ```sql
   ALTER TABLE `{schema}`.`{table}` ADD COLUMN `OMS_PK_INCRMT` bigint;
   ```

* Add unique indexes.

   ```sql
   // Partitioning key columns are available.
   CREATE UNIQUE INDEX `UK_{table}_OBPK_INCRMT` ON `{schema}`.`{table}` (`OMS_PK_INCRMT`, `{partition_col_0}`, `{partition_col_1}`) local;
   // No partitioning key column is available.
   CREATE UNIQUE INDEX `UK_{table}_OBPK_INCRMT` ON `{schema}`.`{table}` (`OMS_PK_INCRMT`);
   ```
