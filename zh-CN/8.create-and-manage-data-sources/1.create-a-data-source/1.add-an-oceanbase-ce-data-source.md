# 添加 OceanBase-CE 数据源

配置好数据源是创建数据迁移项目的前提。启动数据迁移项目前，您必须添加 OceanBase 社区版作为源端或者目标端的数据源。本文为您介绍如何在 OceanBase 迁移服务（OceanBase Migration Service，OMS）社区版中添加 OceanBase-CE 数据源。

## 前提条件

* 已获取相关数据库的 IP 地址和端口号。

* 已存在用于数据迁移的数据库用户。

* 已部署 OBProxy。

建议您为数据迁移项目创建一个专属的数据库用户，该用户必须具备相关的数据操作权限。详情请参见 [用户权限说明](../../2.users-and-privileges/2.user-privileges.md)。

## 操作步骤

1. 登录 OMS 社区版控制台。

2. 在左侧导航栏，单击 **数据源管理**。

3. 在 **数据源列表** 页面，单击右上角的 **添加数据源**。

4. 在 **添加数据源** 面板中，配置各项参数。**数据源类型** 默认为 **OceanBase-CE**。

    |   参数    |    描述       |
   |-------------|-------------|
   | 数据源标识       | 建议使用中文、数字和字母的组合。名称中不能包含空格，长度不得超过 32 个字符。              |
   | 地域              | 从下拉列表中选择数据源所属的地域（即部署 OMS 社区版时配置的 `cm_region` 参数）。 <br>**注意：**  <ul><li> 仅多地域场景下会显示该参数。   <li> 请确保数据源与地域的映射关系保持一致，否则可能导致迁移同步性能较差。  </ul>        |
   | 租户类型        | OceanBase 社区版租户的类型，目前仅支持 MySQL 租户。           |
   | 所属 OCP（可选）      | 从下拉列表中选择已关联的所属 OCP。<ul><li>请自行判断，当前数据源和所选 OCP 是否为被管理关系。<li>设置所属 OCP 是为了 OMS 社区版正常获取 OceanBase 社区版的增量日志，空置本选项会造成增量迁移、增量同步和反向增量选项无法被选择。</ul>如果列表中无目标 OCP，请单击 **添加 OCP**，在 **添加关联 OCP** 中配置各项参数。详情请参见 [关联 OCP](../../7.system-management/3.associate-ocp.md)。                           |
   | 连接方式        | 包括 **手动输入** 和 **命令行连接串**。<ul><li>**手动输入**：手动输入 OceanBase 社区版的公网地址和端口。   <li>**命令行连接串**：输入命令行连接串（可选）。    |
   | 主机 IP       | 数据库宿主机的 IP。      |
   | 端口          | 当前 OceanBase 社区版集群的 OBProxy 端口。    |
   | 租户名         | OceanBase 社区版租户的名称。                                                 |
   | 集群名         | OceanBase 社区版租户所在集群的名称。                               |
   |  数据库用户名         | 用于数据迁移或数据同步的 OceanBase 社区版的用户名称。建议您为数据迁移项目创建单独的数据库用户。    |
   | 数据库密码          | 数据库用户的密码。     |
   | DB Name（可选）  | 数据库的名称。   |
   | 备注（可选）          | 数据源的备注信息。  |

5. （可选）在 **添加数据源** 面板，单击 **高级选项** 右侧的 **展开**，根据业务需求配置相应参数。

   * 创建以 OceanBase-CE 数据源为源端的数据迁移项目时：

     * 增量同步需要输入 Configurl、用户名和密码。

     * 结构迁移需要输入用户名和密码。
  
     * 无唯一键表迁移需要输入 `_OCEANBASE_INNER_DRC_USER` 的密码。

   * 创建以 OceanBase-CE 数据源为目标端的数据迁移项目时，反向增量需要输入 Configurl、用户名和密码。
  
      |参数|描述|
      |---|---|
      |Configurl（可选）|Configurl 主要用于获取 OceanBase 社区版底层服务器的真实地址。<ul><li>如果您已选择 **所属 OCP**，OMS 社区版默认会从 OCP 获取 Configurl，该选项不显示。<li>如果您未选择 **所属 OCP**，可以填写 **用户名** 和 **密码** 后，单击 Configurl 文本框右侧的 **在 OceanBase Server 中查询**，通过 OceanBase Server 获取 Configurl。<br>如果查询失败，则可以在 OceanBase 社区版 sys 租户下，执行 `show parameters like 'obconfig_url'` 命令，查询的 Value 即 Configurl。<li> 如果您未部署 OCP，则需要部署 Web 服务 Config Server，以存取 OceanBase 元数据的信息。 |
      |用户名（可选）|部署 OMS 社区版时，`config.yaml` 文件中的 `drc_user`。<br>该用户主要用于读取 OceanBase 社区版增量日志，以及获取数据库对象结构，请在 sys 租户下创建该用户。|
      |密码（可选）|drc_user 用户对应的密码。|
      |_OCEANBASE_INNER_DRC_USER 密码（可选）|如果您需要迁移无唯一键表，请输入 `_OCEANBASE_INNER_DRC_USER` 的密码。 |

6. 单击 **测试连接**，验证 OMS 社区版和数据库的网络连接，以及用户名和密码的有效性。

7. 测试连接通过后，单击 **添加**。
