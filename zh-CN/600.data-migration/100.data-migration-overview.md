# 数据迁移概述

OceanBase 迁移服务（OceanBase Migration Service，OMS）社区版支持数据迁移功能，您可以通过该功能实现 OceanBase-CE、MySQL、TiDB 和 PostgreSQL 等多种类型的数据源与 OceanBase 社区版进行实时数据传输，以及 OceanBase 社区版 MySQL 租户间的数据迁移。

## 背景信息

数据迁移支持在线迁移，OMS 社区版部署服务器需要能够同时与源实例和目标实例保持网络连通，您只需要配置好待迁移的源端数据源和目标数据源，选择需要迁移的对象后，即可启动数据迁移项目。

OMS 社区版自动执行数据迁移项目的全部流程，成功复制源端数据库（数据表）中的数据库对象、存量数据或增量数据至目标端数据库（数据表），并确保源库至目标库的实时增量同步。

## 支持的项目类型

OMS 社区版为您提供在线迁移数据和实时同步增量数据的功能，支持的项目类型如下：

* [迁移 MySQL 数据库的数据至 OceanBase 社区版](../600.data-migration/200.create-a-project-to-migrate-data-from-a-mysql-database-to-a-mysql-tenant-of-oceanbase-database.md)
  
* [迁移 OceanBase 社区版的数据至 MySQL 数据库](../600.data-migration/300.create-a-project-to-migrate-data-from-a-mysql-tenant-of-oceanbase-database-to-a-mysql-database.md)

* [OceanBase 社区版的单向数据迁移](../600.data-migration/1100.migrate-data-within-oceanbase-database.md)

* [OceanBase 社区版的容灾双活数据迁移](../600.data-migration/1200.create-an-active-active-disaster-recovery-project-in-oceanbase-database.md)

* [迁移 TiDB 数据库的数据至 OceanBase 社区版](../600.data-migration/1300.create-a-project-to-migrate-data-from-a-tidb-database-to-a-mysql-tenant-of-oceanbase-database.md)

* [迁移 PostgreSQL 数据库的数据至 OceanBase 社区版](../600.data-migration/1400.create-a-project-to-migrate-data-from-a-pg-database-to-a-mysql-tenant-of-oceanbase-database.md)

<main id="notice" type='explain'>
<h4>说明</h4>
<p>数据源版本限制请参见 <a href="../200.product-introduction/400.limits.md">使用限制</a>。</p>
</main>
  
## 支持的迁移类型

数据迁移项目每种迁移类型的具体操作请参见《创建数据迁移项目》模块的文档。

| **迁移类型** |                                    **描述**                            |
|----------|----------------------------------------------------------------------------------|
| 结构迁移     | 负责迁移源库中的数据对象定义（表、索引、约束、注释和视图等）至目标端数据库中，会自动过滤临时表。 <br>当源端数据库非 OceanBase 数据库时，会依据目标 OceanBase 租户类型的语法定义标准进行数据类型和 SQL 语法的自动转换和拼装，然后复制至目标库中。                                                                                                                                                   |
| 全量迁移     | 迁移源库表的存量数据至目标端数据库对应的表中。您可以在 **全量迁移** 页面，查看 **表对象**、**表索引** 和 **全量迁移性能**。只有表对象和表索引均迁移完成，全量迁移的状态才会显示已完成。<br>在 **表索引** 页面，单击目标表对象后的 **查看创建语法**，即可查看索引创建语法。 <br>全量迁移加上增量同步，可以确保目标端数据库与源端数据库的最终一致性。如果全量迁移过程中有失败的对象，会为您展示具体的失败原因。                                                                                          |
| 增量同步     | 增量同步任务开始后，会同步源库发生变化的数据（新增、修改或删除）至目标端数据库对应的表中。<br> 当源库不断有业务写入时，OMS 社区版会在全量数据迁移启动前，启动增量拉取模块，以拉取源实例中的增量更新数据，对其进行解析、封装，并存储至 OMS 社区版中。 <br>当全量数据迁移完成后，OMS 社区版会启动增量数据回放模块，从增量数据拉取模块中获取增量数据。增量数据经过过滤、映射和转换后，再同步至目标实例中。                                                                                    |
| 全量校验     | 在全量数据迁移完成，增量数据迁移至目标端并与源端基本追平后，OMS 社区版会自动发起一轮针对源库配置的数据表和目标表的全量数据校验任务。 增量数据同步过程中，您也可以发起自定义的数据校检。对于校验结果不一致的数据，您可以重新校验表中的全部数据或仅重新校验表中不一致的数据。                                                                                                                                       |
| 正向切换     | 正向切换（传统意义上的系统割接流程的抽象化、标准化）不会操作业务应用连接的切换，是 OMS 社区版的数据迁移项目配合应用切换需要执行的任务流。您需要保证在应用连接切换至目标端前完成正向切换的全部流程。<br>正向切换是数据迁移必不可少的一个流程，通过正向切换，OMS 社区版可以确保完成了数据正向迁移的相关工作，并且您可以根据业务需求启动反向增量组件。正向切换主要涉及的工作如下：<ol><li>您需要自行确认已完成数据迁移，并等待正向同步延迟被追平。</li><li>OMS 社区版将会自动补充结构迁移阶段忽略的检查类约束、外键约束等对象。</li><li>OMS 社区版将会自动删除迁移依赖的附加隐藏列及唯一索引。<br>该操作仅在 OceanBase 社区版之间的数据迁移项目存在，详情请参见 [数据迁移服务隐藏列机制说明](../600.data-migration/1600.migration-function-introduction/800.schema-migration-mechanisms.md)。</li><li>您需要自行补充迁移源端触发器、函数、存储过程等其它 OMS 社区版不支持的数据库对象至目标端。</li><li>您需要自行禁用源端的触发器和外键约束（仅数据迁移项目存在反向增量时需要）。</li></ol> |
| 反向增量     | 迁移完成后，针对于业务割接场景，可以引导用户在业务数据库完成切换前在 OMS 社区版上启动目标库至源库（即反向）的增量同步项目，实时回流业务切换后在目标端数据库产生的变更数据至源业务数据库。   |
