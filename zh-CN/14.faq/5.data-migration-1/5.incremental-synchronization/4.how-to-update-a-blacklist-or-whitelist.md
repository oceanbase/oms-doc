# 如何更新黑白名单

本文介绍黑白名单的工作机制，以及如何更新黑白名单。

## 适用版本

本文适用于 OMS 社区版 3.2.2-CE 及以上版本。

## 黑白名单实现原理

黑白名单通过配置化的形式提供了库表过滤、映射、ETL 等差异化配置能力。黑白名单结构如下：

```json
[{
 "name": "db*",
 "map": "mdby",
 "func": "fn",
 "attr": {
  "ddl": "mmm",
  "hey": "hey"
 },
 "sub": [{
  "name": "mb*",
  "map": "tb2222",
  "func": "fn",
  "sub": [{
   "name": "c"
  }]
 }]
}, {
 "name": "db123",
 "map": "mdb5",
 "all": false,
 "attr": {
  "ddl": "zzz",
  "hey": "hey"
 },
 "sub": [{
  "name": "tb12345"
 }]
}]
```

黑白名单由两个结构语义相同的 JSON 来表示，每个 JSON 配置是一个 JSON 数组来表示。每个数组的元素都是一个 JSON 对象， 每个 JSON 对象都包含了如下属性。

| 属性 |                        描述                |
|------|------------------------------|
| name | 该层级的元素的名称，根据所处层级的不同含义不同。通常对于库/表/列三级的使用方式：最外层表示库名，第二层表示表名，第三层表示列名。                                           |
| map  | 该层级 name 的映射名称，如果没有指定，则该值与 name 相同。         |
| all  | 是否需要下一层级的所有的对象，默认为 true。如果在库层级，含义是需要该库下所有的表。如果在表层级，含义是需要该表下所有的列。              |
| func | name 的匹配规则，func 目前支持三种模式。默认为精确匹配，所有字符相同才算相同。fn 为 Linux 的 fnmatch 模式，以 '.' 开头的对象是不能匹配的。reg 为 Java 的正则匹配模式。匹配的时候，优先匹配精准模式，然后遍历 fn, reg 模式匹配。 |
| attr | 该层级的属性，是一个 JSON 对象。例如，过滤 DML 类型的配置，ETL 的配置都会在该属性中提供。   |
| sub  | 下一层的对象，和该层级定义相同，但是随着层数的增加，含义会变化。库的下一层是表，表的下一层是列。 |

>**注意：**
>
>一个匹配生效的前提是它在白名单中并且不在黑名单中.

## 修改黑白名单

以 JDBCWriter 组件为例：

1. 停止 JDBCWriter 组件，详情请参见 [停止 JDBCWriter](../5.incremental-synchronization/3.start-and-stop-jdbcwriter.md)。

2. 根据需要修改的内容修改对应的字段。示例如下：

   * 增加表：在相应数据库的 sub 的属性下面，添加一个 JSON 对象，填写对应的 name、map 等属性，加入到 sub 数组中。

   * 删除表：找到要删除的表，从白名单中删除或者在黑名单中添加该表的配置。

3. 启动 JDBCWriter。
