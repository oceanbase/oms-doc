# 新建 OceanBase-CE 数据源

配置好数据源是创建数据迁移或数据同步项目的前提。本文为您介绍如何在 OceanBase 迁移服务（OceanBase Migration Service，OMS）社区版中新建 OceanBase-CE 数据源。

## 前提条件

* 已获取相关数据库的 IP 地址和端口号。

* 已存在用于数据迁移或数据同步的数据库用户。

   建议您为数据迁移或数据同步项目创建一个专属的数据库用户，该用户必须具备相关的数据操作权限。详情请参见 [创建数据库用户](../300.create-a-database-user.md)。

## 操作步骤

1. 登录 OMS 社区版控制台。

2. 在左侧导航栏，单击 **数据源管理**。

3. 在 **数据源列表** 页面，单击右上角的 **新建数据源**。

4. 在 **新建数据源** 对话框，配置各项参数。**数据源类型** 默认为 **OceanBase-CE**。

    |   参数    |    描述       |
   |-------------|-------------|
   | 数据源标识       | 建议使用中文、数字和字母的组合。名称中不能包含空格，长度不能超过 32 个字符。              |
   | 地域              | 从下拉列表中选择数据源所属的地域。 <br>**注意**  <ul><li> 仅多地域场景下会显示该参数。   <li> 请确保数据源与地域的映射关系保持一致，否则可能导致迁移同步性能较差。  </ul>        |
   | 租户类型        | OceanBase 社区版租户的类型，目前仅支持 MySQL 租户。           |
   | 所属 OCP（可选）      | 从下拉列表中选择已关联的所属 OCP。<ul><li>请自行判断，当前数据源和所选 OCP 是否为被管理关系。<li>设置所属 OCP 是为了 OMS 社区版正常获取 OceanBase 社区版的增量日志，空置本选项会造成增量同步和反向增量选项无法被选择。</ul>如果列表中无目标 OCP，请单击 **添加 OCP**，在 **添加关联 OCP** 中配置各项参数。详情请参见 [关联 OCP](../../1000.system-management/300.associate-with-ocp.md)。                           |
   | 输入方式        | 包括 **手动输入** 和 **命令行连接串**。<ul><li>**手动输入**：请手动输入 OceanBase 社区版的公网地址和端口。   <li>**命令行连接串**：请输入命令行连接串。    |
   | 主机 IP       | 数据库宿主机的 IP。      |
   | 端口          | 数据库宿主机 IP 的端口号。|
   | 租户名（可选）        | OceanBase 社区版租户的名称。<br>如果您需要创建的是公有云 OceanBase 数据源，则无需填写租户名。                                                 |
   | 集群名（可选）         | OceanBase 社区版租户所在集群的名称。                             |
   |  数据库用户名         | 用于数据迁移或数据同步的 OceanBase 社区版的用户名称。建议您为数据迁移项目创建单独的数据库用户。    |
   | 数据库密码          | 数据库用户的密码。     |
   | DB Name（可选）  | 数据库的名称。<br>**说明**<br>如果您配置了 DB Name，当数据源作为源端时，数据迁移或数据同步项目仅支持选择指定 DB Name 下的迁移或同步对象。    |
   | 备注（可选）          | 数据源的备注信息。  |

5. （可选）在 **新建数据源** 对话框，单击 **高级选项** 右侧的 **展开**，根据业务需求配置相应参数。

   |参数|描述|
   |---|---|
   |DRC 用户用户名（可选）|该用户主要用于读取 OceanBase 社区版增量日志和数据库对象结构信息，请在业务集群 `sys` 租户下创建该用户。|
   |Configurl 或者 rootservice（可选）|Configurl 主要用于获取 OceanBase 社区版底层服务器的真实地址。<ul><li>如果您已选择 **所属 OCP**，OMS 社区版默认会从 OCP 获取 Configurl，该选项不显示。</li><li>如果您未选择 **所属 OCP**，可以填写 **用户名** 和 **密码** 后，单击 Configurl 或者 rootservice 文本框右侧的 **在 OceanBase Server 中查询**，通过 OceanBase Server 获取 Configurl 或者 rootservice。<br>如果查询失败，则可以在 OceanBase 社区版 sys 租户下，执行 `show parameters like 'obconfig_url'` 命令，查询的值即 Configurl；执行 `show parameters like 'rootservice_list';` 命令，查询的值即 rootservice。</li></ul>|
   |密码（可选）|drc_user 用户对应的密码。|
   |__oceanbase_inner_drc_user 密码（可选）|该用户主要用于 OceanBase 数据库内无唯一键表的数据迁移。<br>**注意**<br>您需要在当前数据源所在的租户下创建该用户。 |

   * 创建以 OceanBase-CE 数据源为源端的数据迁移或数据同步项目时：

     * 结构迁移/结构同步、增量同步需要输入用户名和密码。如果您未选择 **所属 OCP**，还需要输入 Configurl 或者 rootservice。

     * 迁移无唯一键表时，需要输入 `_OCEANBASE_INNER_DRC_USER` 用户的密码。

   * 创建以 OceanBase-CE 数据源为目标端的数据迁移项目时，反向增量需要输入用户名和密码。如果您未选择 **所属 OCP**，还需要输入 Configurl 或者 rootservice。
  
6. 单击 **测试连接**，验证 OMS 社区版和数据库的网络连接，以及用户名和密码的有效性。

7. 测试连接通过后，单击 **确定**。
