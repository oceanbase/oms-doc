# 部署介绍

本文为您介绍部署 OceanBase 迁移服务（OceanBase Migration Service，OMS）社区版的系统要求和资源配置规格。

## 系统要求

### 操作系统 

OMS 社区版支持以 Docker 容器的方式部署于 Linux 系统主机中，暂不支持裸机部署。

### 部署机端口限制 

在部署机上安装 OMS 社区版，需要使用以下端口。安装前请确认相应的端口未被占用，端口策略正常开通。

* OMS 社区版所在宿主机需要提供以下端口可用。

  |     端口  |     描述    |
  |-----------|------------|
  | 8089      | OMS 社区版管理控制台对应端口。   |
  | 2023      | sshd 服务。          |
  | 8084      | supervisorctl Web 界面。  |
  | 8088      | OMS 社区版的集群管控模块，在 supervisorctl 中的组件名为 `oms_drc_cm`。 |
  | 9000/9001   | 主机 Agent 进程的服务端口。  |
  | 16000\~16499 17000\~17499 18000\~18499  <br>7100\~7499 | OMS 社区版内部组件随机端口。   |

* 如果部署了 InfluxDB，请确认 InfluxDB 所在机器提供 InfluxDB 服务端口 8086 可用。

### NTP 服务 

安装前请确保 OMS 社区版的 Meta 库和所有部署机器配置和启用了 NTP 服务，机器之间的时钟同步，且数据库时区和机器时区保持一致。

### 网络连通性 

请确保 OMS 社区版部署机器和 OBProxy、OBServer、OCP，以及参与迁移的数据源之间的网络连通。

## 资源配置规格 

* 基础服务和管控等常驻组件的标准资源规格建议如下。

  | 资源类型/组件 | 基础服务 |  管控  |  总计  |
  |---------|------|------|------|
  | CPU     | 1C   | 4C   | 5C   |
  | Memory  | 1G   | 7G   | 8G   |
  | Disk    | 100G | 100G | 200G |

* 以单条 MySQL 数据库至 OceanBase 社区版的数据迁移链路为例进行计算，OMS 社区版各组件的标准资源规格建议如下。

  | 资源类型/组件 |                Store                | JDBCWriter | Checker |          总计           |
  |---------|-------------------------------------|------------|---------|-----------------------|
  | CPU     | 4C                                  | 2C         | 2C      | 8C                    |
  | Memory  | 8G                                  | 8G         | 4G      | 20G                   |
  | Disk    | 取决于源端数据库增量日志的生产速度和 OMS 社区版中增量数据的保存时间 | 5G         | 5G      | \>10G |


### 资源规格说明 

* 全量组件

  一条数据迁移链路包含了增量同步组件（Store + JDBCWriter）、全量迁移组件（Checker）和全量校验组件（Checker）。实际运行时，全量迁移和全量校验进程不会同时存在，所以估算链路资源占用时，Checker 只计入一份。
  
* 磁盘估算

  OMS 社区版的磁盘资源主要耗费在缓存增量拉取日志，并存储日志于 OMS 社区版中。OMS 社区版支持回拉数据后再进行迁移。
  
  假设归档日志量为每天 1 TB，实际 OMS 社区版解析和业务相关的数据会少于 1 TB，建议您设置 OMS 社区版日志缓存为 1 TB。
  